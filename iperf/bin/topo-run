#!/bin/bash
#
# Multi topologies run invocation or summary generation
# Usage: topo-run <--label label>
#
# Prereq: set JOBS by hand
#
# Expansion to: run-$LABEL-DATE-TIME
#               run-std-0-2022-06-13-22:36:4
#

JOBS="INTRA-NODE INTER-NODE INGRESS EGRESS HOST-NETWORK HOST-NETWORK-INTRA INTER-HOST"

LABEL=""

function batch_run {
 for job in $JOBS;do
    echo $job
    pushd $job
    this-run -l $1
    popd
 done

}

function f_help {
    me=`basename "$0"` 
    echo "Usage: $me --label day-label"
}

longopts="tag:"
opts=$(getopt -q -o "" --longoptions "$longopts" -n "getopt.sh" -- "$@");
if [ $? -ne 0 ]; then
    echo "Unrecognized option specified"
    exit
fi
eval set -- "$opts";
while true; do
    case "$1" in
        --label)
            shift;
            LABEL=$1
            shift;
            ;;

        --)
            shift;
            break
            ;;
        *)
            echo "Invalid option: $1"
            exit
    esac
done


if [ "$LABEL" == "" ]; then
    f_help
    exit
fi

batch_run $LABEL

