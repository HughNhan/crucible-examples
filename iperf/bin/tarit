#!/bin/bash

# Only process uper* dir, not uperf*.tgt 
RUNS="$(/bin/ls -p | grep / | grep uperf )"

# "ls -p" shows dir entries ended with /

for run in $RUNS
do
    echo $run
    # remove ending /
    name=${run::-1}
    tar --force-local -czvf $name.tgz $name
    if [ $? -eq 0 ]; then
        echo "success"
        rm -fr $run
        chmod -w $name.tgz
     else
        echo "failure"
        rm $run.tgz
     fi
done
