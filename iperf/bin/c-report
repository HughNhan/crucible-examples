#!/bin/bash
#
# Report summary of a daily run
# Usage: c-report [--tag <TAG>]
# Ex:    c-report --tag run-sat
#
#

JOBS="INTER-HOST HOST-NETWORK-INTRA HOST-NETWORK INTRA-NODE INTER-NODE INGRESS EGRESS"

function batch_summary {
  for job in $JOBS;do
    echo TOPO: $job
    pushd $job > /dev/null
    LABEL=$1
    FILES=$(ls *$LABEL*.log)
    #echo $FILES
    for file in $FILES; do
       echo "$(realpath $file):----"
       cat $file | grep 'run-id\|tags:\|common\|unique\|result:'
    done
    popd > /dev/null
  done
}

TAG="run-tues-"
longopts="tag:,help"

opts=$(getopt -q -o "" --longoptions "$longopts" -n "getopt.sh" -- "$@");
if [ $? -ne 0 ]; then
    echo "Unrecognized option specified"
    exit
fi
eval set -- "$opts";
echo "opts after: $@"
while true; do
    case "$1" in
        --tag)
            shift;
            TAG=$1
            shift;
            ;;
        --help)
            shift;
            echo $0 "[--tag <tag_string>]"
            exit
            ;;
        --)
            shift;
            break
            ;;
        *)
            echo "Invalid option: $1"
            exit
    esac
done

echo batch_summary $TAG
batch_summary $TAG

