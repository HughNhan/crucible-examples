#!/bin/bash
#
# Report summary of a daily run
# Usage: c-report [--tag <TAG>]
# Ex:    c-report --tag run-sat
#
#

JOBS="INTER-HOST HOST-NETWORK-INTRA HOST-NETWORK INTRA-NODE INTER-NODE INGRESS EGRESS"

LABEL=""
function batch_summary {
  for job in $JOBS;do
    echo TOPO: $job
    if [ ! -d $job ]; then
        echo "$job has no runs"
        continue
    fi
    pushd $job > /dev/null
    LABEL=$1
    FILES=$(ls *$LABEL*.log)
    #echo $FILES
    for file in $FILES; do
       echo "$(realpath $file):----"
       cat $file | grep 'run-id\|tags:\|common\|unique\|result:'
    done
    popd > /dev/null
  done
}

longopts="label:,help"

opts=$(getopt -q -o "" --longoptions "$longopts" -n "getopt.sh" -- "$@");
if [ $? -ne 0 ]; then
    echo "Unrecognized option specified"
    exit
fi
eval set -- "$opts";
echo "opts after: $@"
while true; do
    case "$1" in
        --label)
            shift;
            LABEL=$1
            shift;
            ;;
        --help)
            shift;
            echo $0 "[--label <tag_string>]"
            exit
            ;;
        --)
            shift;
            break
            ;;
        *)
            echo "Invalid option: $1"
            exit
    esac
done

if [ "$LABEL" == "" ]; then
    echo $0 "[--label <tag_string>]"
    exit
    
fi

echo batch_summary $LABEL
batch_summary $LABEL

